<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hallgatói Adatbázis - BQLOTW</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f4f7f9;
            margin: 0;
            padding: 20px;
            color: #333;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .container {
            width: 100%;
            max-width: 1200px;
        }
        h1, h2 {
            color: #2c3e50;
            text-align: center;
        }
        .card {
            background: #ffffff;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 25px;
            margin-bottom: 25px;
        }
        form label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }
        form input[type="text"],
        form input[type="number"],
        form input[type="email"] {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
            transition: border-color 0.3s;
        }
        form input:focus {
            border-color: #3498db;
            outline: none;
        }
        .button, button {
            background-color: #3498db;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
            transition: background-color 0.3s;
        }
        .button:hover, button:hover {
            background-color: #2980b9;
        }
        .button-danger {
            background-color: #e74c3c;
        }
        .button-danger:hover {
            background-color: #c0392b;
        }
        .button-secondary {
            background-color: #95a5a6;
        }
        .button-secondary:hover {
            background-color: #7f8c8d;
        }
        .controls, .io-section {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        .controls input, .controls select {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            padding: 12px;
            border-bottom: 1px solid #ddd;
            text-align: left;
        }
        th {
            background-color: #ecf0f1;
            font-weight: bold;
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        tr:hover {
            background-color: #f1f1f1;
        }
        #json-import-label {
            display: inline-block;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Hallgatói Adatbázis</h1>

        <div class="card">
            <h2 id="form-title">Új hallgató felvétele</h2>
            <form id="student-form">
                <input type="hidden" id="student-id">
                <label for="name">Név:</label>
                <input type="text" id="name" required>

                <label for="year">Évfolyam:</label>
                <input type="number" id="year" required>

                <label for="major">Szak:</label>
                <input type="text" id="major" required>

                <label for="email">Email:</label>
                <input type="email" id="email" required>

                <label for="neptun">Neptunkód:</label>
                <input type="text" id="neptun" required pattern="[A-Z0-9]{6}" title="6 karakteres Neptun kód (pl. BQLOTW)">

                <button type="submit" id="save-btn">Mentés</button>
                <button type="button" class="button-secondary" id="cancel-btn" style="display:none;">Mégse</button>
            </form>
        </div>

        <div class="card">
            <h2>Kezelőpult</h2>
            <div class="controls">
                <input type="text" id="search" placeholder="Keresés név, szak, email stb. alapján...">
                <select id="sort">
                    <option value="">Rendezés</option>
                    <option value="name">Név szerint</option>
                    <option value="year">Évfolyam szerint</option>
                </select>
            </div>
            <div class="io-section" style="margin-top: 20px;">
                <button id="export-json" class="button-secondary">Exportálás JSON-be</button>
                <label for="import-json" id="json-import-label" class="button button-secondary">Importálás JSON-ből</label>
                <input type="file" id="import-json" accept=".json" style="display:none;">
            </div>
        </div>

        <div class="card">
            <h2>Hallgatók listája</h2>
            <table>
                <thead>
                    <tr>
                        <th>Név</th>
                        <th>Évfolyam</th>
                        <th>Szak</th>
                        <th>Email</th>
                        <th>Neptunkód</th>
                        <th>Műveletek</th>
                    </tr>
                </thead>
                <tbody id="student-list">
                    <!-- Hallgatói adatok ide kerülnek -->
                </tbody>
            </table>
        </div>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const studentForm = document.getElementById('student-form');
    const studentIdInput = document.getElementById('student-id');
    const nameInput = document.getElementById('name');
    const yearInput = document.getElementById('year');
    const majorInput = document.getElementById('major');
    const emailInput = document.getElementById('email');
    const neptunInput = document.getElementById('neptun');
    const studentList = document.getElementById('student-list');
    const searchInput = document.getElementById('search');
    const sortSelect = document.getElementById('sort');
    const exportBtn = document.getElementById('export-json');
    const importInput = document.getElementById('import-json');
    const formTitle = document.getElementById('form-title');
    const saveBtn = document.getElementById('save-btn');
    const cancelBtn = document.getElementById('cancel-btn');

    let students = JSON.parse(localStorage.getItem('students-bqlotw')) || [];

    const saveToLocalStorage = () => {
        localStorage.setItem('students-bqlotw', JSON.stringify(students));
    };

    const renderTable = () => {
        studentList.innerHTML = '';
        
        const searchTerm = searchInput.value.toLowerCase();
        const sortBy = sortSelect.value;

        let filteredStudents = students.filter(student =>
            student.name.toLowerCase().includes(searchTerm) ||
            student.year.toString().includes(searchTerm) ||
            student.major.toLowerCase().includes(searchTerm) ||
            student.email.toLowerCase().includes(searchTerm) ||
            student.neptun.toLowerCase().includes(searchTerm)
        );

        if (sortBy === 'name') {
            filteredStudents.sort((a, b) => a.name.localeCompare(b.name));
        } else if (sortBy === 'year') {
            filteredStudents.sort((a, b) => a.year - b.year);
        }

        if (filteredStudents.length === 0) {
            studentList.innerHTML = '<tr><td colspan="6" style="text-align:center;">Nincsenek megjeleníthető adatok.</td></tr>';
            return;
        }

        filteredStudents.forEach(student => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${student.name}</td>
                <td>${student.year}</td>
                <td>${student.major}</td>
                <td>${student.email}</td>
                <td>${student.neptun}</td>
                <td>
                    <button class="button-secondary" onclick="startEdit('${student.neptun}')">Módosítás</button>
                    <button class="button-danger" onclick="deleteStudent('${student.neptun}')">Törlés</button>
                </td>
            `;
            studentList.appendChild(row);
        });
    };

    const resetForm = () => {
        studentForm.reset();
        studentIdInput.value = '';
        formTitle.textContent = 'Új hallgató felvétele';
        saveBtn.textContent = 'Mentés';
        neptunInput.disabled = false;
        cancelBtn.style.display = 'none';
    };

    studentForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const id = studentIdInput.value;
        const neptun = neptunInput.value;

        const studentData = {
            name: nameInput.value,
            year: parseInt(yearInput.value),
            major: majorInput.value,
            email: emailInput.value,
            neptun: neptun,
        };
        
        if (id) { // Update existing
            const index = students.findIndex(s => s.neptun === id);
            if (index !== -1) {
                students[index] = studentData;
            }
        } else { // Add new
            if (students.some(s => s.neptun === neptun)) {
                alert('Hiba: Ez a Neptunkód már létezik!');
                return;
            }
            students.push(studentData);
        }

        saveToLocalStorage();
        renderTable();
        resetForm();
    });

    window.startEdit = (neptun) => {
        const student = students.find(s => s.neptun === neptun);
        if (student) {
            formTitle.textContent = 'Hallgató adatainak módosítása';
            saveBtn.textContent = 'Frissítés';
            studentIdInput.value = student.neptun;
            nameInput.value = student.name;
            yearInput.value = student.year;
            majorInput.value = student.major;
            emailInput.value = student.email;
            neptunInput.value = student.neptun;
            neptunInput.disabled = true; // Prevent changing the unique ID
            cancelBtn.style.display = 'inline-block';
            window.scrollTo(0, 0);
        }
    };

    window.deleteStudent = (neptun) => {
        if (confirm(`Biztosan törölni szeretné a hallgatót (${neptun})?`)) {
            students = students.filter(s => s.neptun !== neptun);
            saveToLocalStorage();
            renderTable();
        }
    };
    
    cancelBtn.addEventListener('click', resetForm);
    searchInput.addEventListener('input', renderTable);
    sortSelect.addEventListener('change', renderTable);

    exportBtn.addEventListener('click', () => {
        if (students.length === 0) {
            alert('Nincs exportálható adat.');
            return;
        }
        const dataStr = JSON.stringify(students, null, 2);
        const blob = new Blob([dataStr], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'hallgatok_bqlotw.json';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    });

    importInput.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = (event) => {
            try {
                const importedStudents = JSON.parse(event.target.result);
                if (Array.isArray(importedStudents) && importedStudents.every(s => s.neptun)) {
                    if (confirm('Biztosan felülírja a jelenlegi adatbázist az importált adatokkal?')) {
                        students = importedStudents;
                        saveToLocalStorage();
                        renderTable();
                        alert('Az adatok sikeresen importálva.');
                    }
                } else {
                    alert('Hiba: A JSON fájl formátuma nem megfelelő.');
                }
            } catch (error) {
                alert('Hiba a JSON fájl beolvasása közben.');
                console.error(error);
            } finally {
                importInput.value = ''; // Reset file input
            }
        };
        reader.readAsText(file);
    });

    renderTable(); // Initial render on page load
});
</script>

</body>
</html>
